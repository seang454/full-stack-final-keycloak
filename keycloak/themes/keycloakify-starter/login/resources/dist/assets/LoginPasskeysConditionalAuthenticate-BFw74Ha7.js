import{r as O,j as e}from"./index-DIhzf7wa.js";import{a as N,u as S,g as w,c as B}from"./KcPage-CcRVjnQI.js";import{w as $}from"./waitForElementMountedOnDom-qpCjLZnq.js";N();N();function F(j){const{authButtonId:i,kcContext:c,i18n:l}=j,{url:o,isUserIdentified:x,challenge:m,userVerification:d,rpId:b,createTimeout:u}=c,{msgStr:h,isFetchingTranslations:p}=l,{insertScriptTags:n}=S({componentOrHookName:"LoginRecoveryAuthnCodeConfig",scriptTags:[{type:"module",textContent:()=>`
                    import { authenticateByWebAuthn } from "${o.resourcesPath}/js/webauthnAuthenticate.js";
                    import { initAuthenticate } from "${o.resourcesPath}/js/passkeysConditionalAuth.js";

                    const authButton = document.getElementById("${i}");
                    const input = {
                        isUserIdentified : ${x},
                        challenge : ${JSON.stringify(m)},
                        userVerification : ${JSON.stringify(d)},
                        rpId : ${JSON.stringify(b)},
                        createTimeout : ${u}
                    };
                    authButton.addEventListener("click", () => {
                        authenticateByWebAuthn({
                            ...input,
                            errmsg : ${JSON.stringify(h("webauthn-unsupported-browser-text"))}
                        });
                    });

                    initAuthenticate({
                        ...input,
                        errmsg : ${JSON.stringify(h("passkey-unsupported-browser-text"))}
                    });
                `}]});O.useEffect(()=>{p||(async()=>(await $({elementId:i}),n()))()},[p])}function P(j){var i;const{kcContext:c,i18n:l,doUseDefaultCss:o,Template:x,classes:m}=j,{messagesPerField:d,login:b,url:u,usernameHidden:h,shouldDisplayAuthenticators:p,authenticators:n,registrationDisabled:A,realm:y}=c,{msg:r,msgStr:I,advancedMsg:f}=l,{kcClsx:s}=w({doUseDefaultCss:o,classes:m}),C="authenticateWebAuthnButton";return F({authButtonId:C,kcContext:c,i18n:l}),e.jsxs(x,Object.assign({kcContext:c,i18n:l,doUseDefaultCss:o,classes:m,headerNode:r("passkey-login-title"),infoNode:y.registrationAllowed&&!A&&e.jsx("div",Object.assign({id:"kc-registration"},{children:e.jsxs("span",{children:["$",r("noAccount")," ",e.jsx("a",Object.assign({tabIndex:6,href:u.registrationUrl},{children:r("doRegister")}))]})}))},{children:[e.jsxs("form",Object.assign({id:"webauth",action:u.loginAction,method:"post"},{children:[e.jsx("input",{type:"hidden",id:"clientDataJSON",name:"clientDataJSON"}),e.jsx("input",{type:"hidden",id:"authenticatorData",name:"authenticatorData"}),e.jsx("input",{type:"hidden",id:"signature",name:"signature"}),e.jsx("input",{type:"hidden",id:"credentialId",name:"credentialId"}),e.jsx("input",{type:"hidden",id:"userHandle",name:"userHandle"}),e.jsx("input",{type:"hidden",id:"error",name:"error"})]})),e.jsxs("div",Object.assign({className:s("kcFormGroupClass"),"no-bottom-margin":"true",style:{marginBottom:0}},{children:[n!==void 0&&Object.keys(n).length!==0&&e.jsxs(e.Fragment,{children:[e.jsx("form",Object.assign({id:"authn_select",className:s("kcFormClass")},{children:n.authenticators.map((t,a)=>e.jsx("input",{type:"hidden",name:"authn_use_chk",readOnly:!0,value:t.credentialId},a))})),p&&e.jsxs(e.Fragment,{children:[n.authenticators.length>1&&e.jsx("p",Object.assign({className:s("kcSelectAuthListItemTitle")},{children:r("passkey-available-authenticators")})),e.jsx("div",Object.assign({className:s("kcFormClass")},{children:n.authenticators.map((t,a)=>e.jsxs("div",Object.assign({id:`kc-webauthn-authenticator-item-${a}`,className:s("kcSelectAuthListItemClass")},{children:[e.jsx("i",{className:B((()=>{const g=s(t.transports.iconClass);return g===t.transports.iconClass?s("kcWebAuthnDefaultIcon"):g})(),s("kcSelectAuthListItemIconPropertyClass"))}),e.jsxs("div",Object.assign({className:s("kcSelectAuthListItemBodyClass")},{children:[e.jsx("div",Object.assign({id:`kc-webauthn-authenticator-label-${a}`,className:s("kcSelectAuthListItemHeadingClass")},{children:f(t.label)})),t.transports!==void 0&&t.transports.displayNameProperties!==void 0&&t.transports.displayNameProperties.length!==0&&e.jsx("div",Object.assign({id:`kc-webauthn-authenticator-transport-${a}`,className:s("kcSelectAuthListItemDescriptionClass")},{children:t.transports.displayNameProperties.map((g,k,v)=>e.jsxs(O.Fragment,{children:[e.jsxs("span",{children:[" ",f(g)," "]},k),k!==v.length-1&&e.jsx("span",{children:", "})]},k))})),e.jsxs("div",Object.assign({className:s("kcSelectAuthListItemDescriptionClass")},{children:[e.jsx("span",Object.assign({id:`kc-webauthn-authenticator-createdlabel-${a}`},{children:r("passkey-createdAt-label")})),e.jsx("span",Object.assign({id:`kc-webauthn-authenticator-created-${a}`},{children:t.createdAt}))]}))]})),e.jsx("div",{className:s("kcSelectAuthListItemFillClass")})]}),a))}))]})]}),e.jsx("div",Object.assign({id:"kc-form"},{children:e.jsxs("div",Object.assign({id:"kc-form-wrapper"},{children:[y.password&&e.jsx("form",Object.assign({id:"kc-form-login",action:u.loginAction,method:"post",style:{display:"none"},onSubmit:t=>{try{t.target.login.disabled=!0}catch{}return!0}},{children:!h&&e.jsxs("div",Object.assign({className:s("kcFormGroupClass")},{children:[e.jsx("label",Object.assign({htmlFor:"username",className:s("kcLabelClass")},{children:r("passkey-autofill-select")})),e.jsx("input",{tabIndex:1,id:"username","aria-invalid":d.existsError("username"),className:s("kcInputClass"),name:"username",defaultValue:(i=b.username)!==null&&i!==void 0?i:"",autoComplete:"username webauthn",type:"text",autoFocus:!0}),d.existsError("username")&&e.jsx("span",Object.assign({id:"input-error-username",className:s("kcInputErrorMessageClass"),"aria-live":"polite"},{children:d.get("username")}))]}))})),e.jsx("div",Object.assign({id:"kc-form-passkey-button",className:s("kcFormButtonsClass"),style:{display:"none"}},{children:e.jsx("input",{id:C,type:"button",autoFocus:!0,value:I("passkey-doAuthenticate"),className:s("kcButtonClass","kcButtonPrimaryClass","kcButtonBlockClass","kcButtonLargeClass")})}))]}))}))]}))]}))}export{P as default};
